---
title: "Equivalence Tests Using {marginaleffects}"
subtitle: "Reproducing the Clark and Golder (2006) Example from Rainey (2014)"
author: "Carlisle Rainey"
date: "2023-08-18"
categories: [hypothesis tests, confidence intervals, equivalence tests, negligible effects, computing, R, marginaleffects]
description: "In this post, I try out the {marginaleffects} package to conduct two one-sided tests (TOSTs) to test a hypothesis of a negligible effect (i.e., equivalence testing)."
image: "rainey-2014-cg-example.png"
reference-location: margin
toc: false
twitter-card:
  card-style: summary_large_image
  image: "rainey-2014-cg-example.png"
  title: "Equivalence Tests with {marginaleffects}"  # less than 55 chars
  description: "Reproducing the Clark and Golder (2006) example from Rainey (2014)"  # less than 125 chars
open-graph:   
  image: "rainey-2014-cg-example.png"
  title: "Equivalence Tests with {marginaleffects}"  # less than 55 chars
  description: "Reproducing the Clark and Golder (2006) example from Rainey (2014)"  # less than 125 chars
code-annotations: hover
code-fold: false
execute: 
  cache: true
draft: false
---

## Background on arguing for a negligible effect

First, a bit of background on the paper and the idea of hypothesizing that a variable "has no effect."

I remember sitting in a talk as a first-year graduate student, and the speaker said something like: "I expect no effect here, and, just as I expected, the difference is not statistically significant." I was a little bit taken aback---of course, that's not a compelling argument for a null effect. But I saw this approach taken again and again in published work. 

My first publication was an *AJPS* article ([Rainey 2014](https://doi.org/10.1111/ajps.12102)) explaining why this doesn't work well and how to do it better. 

Here's what I wrote in that paper: 

> Hypothesis testing is a powerful empirical argument not because it shows that the data are consistent with the research hypothesis, but because it shows that the data are inconsistent with other hypotheses (i.e., the null hypothesis). However, researchers sometimes reverse this logic when arguing for a negligible effect, showing only that the data are consistent with "no effect" and failing to show that the data are inconsistent with meaningful effects. When researchers argue that a variable has "no effect" because its confidence interval contains zero, they take no steps to rule out large, meaningful effects, making the empirical claim considerably less persuasive ([Altman and Bland 1995](https://doi.org/10.1136/bmj.311.7003.485); [Gill 1999](https://doi.org/10.1177/106591299905200309); [Nickerson 2000](https://psycnet.apa.org/doi/10.1037/1082-989X.5.2.241)). 

But here's a critical point, it's impossible to reject every hypothesis except *exactly* no effect. Instead, the researcher must define a range of substantively "negligible" effects. This requires a substantive judgement about those effects that are negligible and those that are not.

Here's what I wrote: 

> Researchers who wish to argue for a negligible effect must precisely define the set of effects that are deemed "negligible" as well as the set of effects that are "meaningful." This requires defining the smallest substantively meaningful effect, which I denote as $m$. The definition must be debated by substantive scholars for any given context because the appropriate $m$ varies widely across applications.

## Clark and Golder (2006) 

[Clark and Golder (2006)](https://doi.org/10.1177/0010414005278420) offer a nice example of this sort of hypothesis. I'll refer you there and to [Rainey 2014](https://doi.org/10.1111/ajps.12102) for a complete discussion of their idea, but I'll motivate it briefly here.

Explaining why a country might have only a few (i.e., two) parties, Clark and Golder write:

> First, it could be the case that the demand for parties is low because there are few social cleavages. In this situation, there would be few parties whether the electoral institutions were permissive or not. Second, it could be the case that the electoral system is not permissive. In this situation, there would be a small number of parties even if the demand for political parties were high. Only a polity characterized by both a high degree of social heterogeneity and a highly permissive electoral system is expected to produce a large number of parties. (p. 683)

Thus, they expect that electoral institutions won't matter in socially homogenous systems. And they expect that social heterogeneity won't matter in electoral systems that are not permissive.

## Reproducing Clark and Golder (2006) 

Before computing their specific quantities of interest, let's reproduce their regression model. Here's their table that we're trying to reproduce.

![](clark-golder-2006-table2.png)

And here's a reproduction of their estimates using the data from the [{crdata} package](http://www.carlislerainey.com/crdata/) on GitHub.

```{r}
#| message: false

# install my data packages from github
devtools::install_github("carlislerainey/crdata")  # only updates if newer version available

# load clark and golder's data set
cg <- crdata::cg2006

# reproduce their estimates
f <- enep ~ eneg*log(average_magnitude) + eneg*upper_tier + en_pres*proximity
fit <- lm(f, data = cg)

# cluster-robust standard errors
Sigma_hat <- sandwich::vcovCL(fit, cluster = ~ country, type = "HC1")

# regression table
modelsummary::modelsummary(fit, vcov = Sigma_hat, fmt = 2, shape = term ~ model + statistic)
```

Success!

They use `averge_magnitude` to measure the permissiveness of the electoral system and `eneg` to measure social heterogeneity.

## Using `comparisons()` to compute the effects

Now let's compute the two quantities of interest. Clark and Golder argue for two negligible effects, which I make really concrete below.

- **Hypothesis 1** Increasing the effective number of ethnic groups from the 10th percentile (1.06) to the 90th percentile (2.48) will not lead to a substantively meaningful change in the effective number of political parties when the district magnitude is one.
- **Hypothesis 2** Increasing the district magnitude from one to seven will not lead to a substantively meaningful change in the effective number of political parties when the effective number of ethnic groups is one.

And comparing the U.S. and the U.K., I argue that the smallest substantively interesting effect is 0.62. In [Rainey (2014)](https://doi.org/10.1111/ajps.12102), I made this plot. I want to reproduce it here.

![](rainey-2014-cg-example.png)

These differences (and the 90% CIs) is really easy to compute using {marginaleffects}! (I'm only doing Clark and Golder's original results, not any of the robustness checks)

```{r}

library(tidyverse)
library(marginaleffects)

# the smallest substantively interesting effect
m <- 0.62

# a data frame setting the values of the "other" variables
X_c <- data.frame(
  eneg = 1.06,  # low value
  average_magnitude = 1,  # low value
  upper_tier = 0,
  en_pres = 0, 
  proximity = 0
)

# compute the comparison for eneg
eneg_comp <- comparisons(fit,
                    vcov = Sigma_hat,
                    newdata = X_c, 
                    variables = list("eneg" = c(1.06, 2.48)), # low to high value
                    conf_level = 0.90)

# compute the comparison for average magnitude
mag_comp<- comparisons(fit,
                    vcov = Sigma_hat,
                    newdata = X_c, 
                    variables = list("average_magnitude" = c(1, 7)), # low to high value
                    conf_level = 0.90)
```

Now we can just plot them with `ggplot()` and check whether the entire interval falls inside the bounds.

```{r}
# bind the comparisons together and plot
comp <- bind_rows(eneg_comp, mag_comp)
ggplot(comp, aes(x = estimate,
                 xmin = conf.low,
                 xmax = conf.high, 
                 y = term)) + 
  geom_vline(xintercept = c(-m, m), linetype = "dashed") + 
  geom_errorbarh() + 
  geom_point() 
```

In this case, we conclude that social heterogeneity (`eneg`) has a negligible effect because the 90% CI only contains substantively negligible values. However, the 90% CI for district magnitude (`average_magnitude`) contains substantively neglible and meaningful values, so we cannot reject the null hypothesis of a meaningful effect.

## Computing the TOST *p*-values using `hypotheses()`

It's then almost trivial to use the `hypotheses()` function to compute the TOST *p*-values.

```{r}
# hypothesis tests
hypotheses(eneg_comp, equivalence = c(-m, m))
hypotheses(mag_comp, equivalence = c(-m, m))
```

Checking that the 90% CIs fall within the bounds created by the smallest substantively-meaningful effect is equivalent to checking whether the TOST *p*-value (i.e., the `p(Equiv)` column) is less than 0.05, so our conclusions are (and must be) identical.
